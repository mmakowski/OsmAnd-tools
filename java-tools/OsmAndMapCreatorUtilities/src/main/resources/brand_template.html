<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brand Analysis by Region</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: #f8f9fa;
            color: #212529;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
            flex-basis: 100%;
        }
        .search-container {
            flex-grow: 1;
        }
        .search-container label, .filter-container label {
            font-weight: bold;
            margin-right: 10px;
        }
        #regionSearch {
            width: 300px;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        .stats-container {
            display: flex;
            gap: 20px;
            background-color: #e9ecef;
            padding: 10px 15px;
            border-radius: 4px;
            justify-content: center;
            min-height: 24px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .stat {
            font-size: 0.9em;
            font-weight: 500;
        }
        .stat-value {
            font-weight: bold;
            color: #007bff;
        }
        .filter-container {
            display: flex;
            align-items: center;
        }
        #countFilter {
            width: 70px;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        .nav-container {
            background-color: #ffffff;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        #breadcrumbs a {
            color: #007bff;
            text-decoration: none;
            cursor: pointer;
        }
        #breadcrumbs a:hover {
            text-decoration: underline;
        }
        #breadcrumbs span {
            color: #6c757d;
        }
        .content {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #regionTitle {
            margin-top: 0;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
        }
        th {
            background-color: #f8f9fa;
        }
        tr:hover {
            background-color: #f1f3f5;
        }
        .clickable-row {
            cursor: pointer;
        }
        .not-included {
            color: #6c757d;
        }
        .owner-brand {
            font-weight: bold;
            color: #000000 !important; /* Override other color styles */
        }
        .sortable {
            cursor: pointer;
            user-select: none;
        }
        .sortable:hover {
            color: #0056b3;
        }
        .emoji-cell {
            width: 20px;
            text-align: center;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>Brand Analysis</h1>
            <div class="search-container">
                <label for="regionSearch">Select a Region:</label>
                <input type="text" id="regionSearch" list="regionList" placeholder="Type to search or clear for overview">
                <datalist id="regionList"></datalist>
            </div>
             <div class="filter-container" id="filter-container">
                <label for="countFilter">Filter > </label>
                <input type="number" id="countFilter" value="7" min="0">
            </div>
        </div>

        <div class="nav-container" id="nav-container">
            <strong>Path:</strong>
            <span id="breadcrumbs">Global Overview</span>
        </div>

        <div class="content" id="content-area">
            <h2 id="regionTitle">All Regions Overview</h2>
            <div id="stats" class="stats-container">
                <!-- Statistics will be loaded here -->
            </div>
            <div id="brand-list-container" style="overflow-x:auto;">
                <table id="mainTable">
                    <thead>
                        <!-- Headers will be loaded here -->
                    </thead>
                    <tbody>
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // BRAND_DATA_PLACEHOLDER
        const brandsData = {
            '1': { name: 'Coca-Cola', owner: 'usa', ownerCount: 4800, globalCount: 5000, ownerPercent: 96, includeReason: 'Globally recognized', include: true },
            '2': { name: 'Toyota', owner: 'japan', ownerCount: 4300, globalCount: 4500, ownerPercent: 95, includeReason: 'Top automaker', include: true },
            '3': { name: 'Samsung', owner: 'south_korea', ownerCount: 3900, globalCount: 4000, ownerPercent: 97, includeReason: 'Electronics giant', include: true },
            '4': { name: 'Mercedes', owner: 'germany', ownerCount: 3200, globalCount: 3500, ownerPercent: 91, includeReason: 'Luxury vehicle leader', include: true },
            '5': { name: 'BMW', owner: 'germany', ownerCount: 2700, globalCount: 2800, ownerPercent: 96, includeReason: 'High regional presence', include: true },
            '6': { name: 'LVMH', owner: 'france', ownerCount: 1000, globalCount: 1100, ownerPercent: 90, includeReason: 'Luxury market dominance', include: true },
            '7': { name: 'IKEA', owner: 'sweden', ownerCount: 600, globalCount: 700, ownerPercent: 85, includeReason: 'Strong brand recognition', include: true },
            '8': { name: 'Zara', owner: 'spain', ownerCount: 550, globalCount: 650, ownerPercent: 84, includeReason: 'Fast fashion leader', include: true },
            '9': { name: 'SAP', owner: 'germany', ownerCount: 1400, globalCount: 1500, ownerPercent: 93, includeReason: 'Top brand', include: true },
            '10': { name: 'A very long German brand name that needs to be truncated', owner: 'germany', ownerCount: 50, globalCount: 50, ownerPercent: 100, includeReason: null, include: false },
            '11': { name: 'Volkswagen', owner: 'germany', ownerCount: 2000, globalCount: 3000, ownerPercent: 66, includeReason: null, include: false },
            '12': { name: 'Roshen', owner: 'ukraine', ownerCount: 500, globalCount: 600, ownerPercent: 83, includeReason: 'Top brand', include: true },
            '13': { name: 'MHP', owner: 'ukraine', ownerCount: 300, globalCount: 350, ownerPercent: 85, includeReason: 'Top brand', include: true },
            '14': { name: 'Apple', owner: 'usa', ownerCount: 4900, globalCount: 5100, ownerPercent: 96, includeReason: 'Top brand', include: true },
            '15': { name: 'Microsoft', owner: 'usa', ownerCount: 4500, globalCount: 4600, ownerPercent: 97, includeReason: 'Top brand', include: true },
            '16': { name: 'Shopify', owner: 'canada', ownerCount: 400, globalCount: 450, ownerPercent: 88, includeReason: 'Top brand', include: true },
            '17': { name: 'Ford', owner: 'usa', ownerCount: 1500, globalCount: 2000, ownerPercent: 75, includeReason: null, include: false },
            '18': { name: 'Tencent', owner: 'china', ownerCount: 3000, globalCount: 3100, ownerPercent: 96, includeReason: 'Top brand', include: true },
            '19': { name: 'Sony', owner: 'japan', ownerCount: 2000, globalCount: 2200, ownerPercent: 90, includeReason: null, include: false },
            '20': { name: 'Nintendo', owner: 'japan', ownerCount: 1800, globalCount: 1900, ownerPercent: 94, includeReason: null, include: false }
        };

        const brandsRegionData = {
            'planet': { parent: null, included: '10', depth: 0, leaf: false, brands: [ { id: 1, count: 5000 }, { id: 2, count: 4500 }, { id: 3, count: 4000 }, { id: 4, count: 3500 } ] },
            'europe': { parent: 'planet', included: '5', depth: 1, leaf: false, brands: [ { id: 4, count: 1500 }, { id: 5, count: 1200 }, { id: 6, count: 800 }, { id: 1, count: 900 }, { id: 7, count: 600 }, { id: 8, count: 550 } ] },
            'germany': { parent: 'europe', included: '3', depth: 2, leaf: true, brands: [ { id: 4, count: 1200 }, { id: 5, count: 1000 }, { id: 9, count: 800 }, { id: 10, count: 50 }, { id: 11, count: 5 } ] },
            'ukraine': { parent: 'europe', included: '2', depth: 2, leaf: true, brands: [ { id: 12, count: 500 }, { id: 13, count: 300 }, { id: 1, count: 150 }, { id: 4, count: 50 } ] },
            'north_america': { parent: 'planet', included: '4', depth: 1, leaf: false, brands: [ { id: 1, count: 2500 }, { id: 14, count: 2200 }, { id: 15, count: 1800 }, { id: 2, count: 800 }, { id: 16, count: 400 } ] },
            'usa': { parent: 'north_america', included: '3', depth: 2, leaf: true, brands: [ { id: 1, count: 2400 }, { id: 14, count: 2100 }, { id: 15, count: 1750 }, { id: 17, count: 6 } ] },
            'asia': { parent: 'planet', included: '3', depth: 1, leaf: false, brands: [ { id: 2, count: 2000 }, { id: 3, count: 1800 }, { id: 18, count: 1500 }, { id: 4, count: 400 } ] },
            'japan': { parent: 'asia', included: '1', depth: 2, leaf: true, brands: [ { id: 2, count: 1900 }, { id: 19, count: 8 }, { id: 20, count: 4 } ] }
        };
        // BRAND_DATA_PLACEHOLDER

        let sortState = { column: 'included', direction: 'desc' };

        document.addEventListener('DOMContentLoaded', () => {
            const regionSearch = document.getElementById('regionSearch');
            const regionList = document.getElementById('regionList');
            const countFilter = document.getElementById('countFilter');

            const allRegionNames = Object.keys(brandsRegionData).sort();

            const updateDatalist = (filter = '') => {
                regionList.innerHTML = '';
                const lowerCaseFilter = filter.toLowerCase();
                const filteredRegions = allRegionNames.filter(name => name.toLowerCase().includes(lowerCaseFilter));
                
                const limit = Math.min(filteredRegions.length, 10);
                for (let i = 0; i < limit; i++) {
                    const option = document.createElement('option');
                    option.value = filteredRegions[i];
                    regionList.appendChild(option);
                }
            };
            
            updateDatalist();

            const handleViewChange = () => {
                const selectedRegion = regionSearch.value;
                if (brandsRegionData[selectedRegion]) {
                    displayRegionDetailView(selectedRegion);
                } else {
                    displayGlobalStatsView();
                }
            };

            regionSearch.addEventListener('input', (e) => {
                updateDatalist(e.target.value);
                if (!e.target.value) displayGlobalStatsView();
            });

            regionSearch.addEventListener('change', handleViewChange);
            countFilter.addEventListener('input', handleViewChange);
            
            displayGlobalStatsView();
        });

        function switchView(isDetailView) {
            document.getElementById('nav-container').style.display = isDetailView ? 'block' : 'none';
        }
        
        function truncateText(text, maxLength = 30) {
            if (!text) return '';
            return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
        }

        function displayGlobalStatsView() {
            switchView(false);
            const filterValue = parseInt(document.getElementById('countFilter').value, 10) || 0;
            const regionTitle = document.getElementById('regionTitle');
            const statsContainer = document.getElementById('stats');
            const table = document.getElementById('mainTable');
            const thead = table.querySelector('thead');
            const tbody = table.querySelector('tbody');

            regionTitle.textContent = 'All Regions Overview';
            regionTitle.removeAttribute('data-region');
            
            const allRegions = Object.entries(brandsRegionData).map(([name, data]) => ({
                name,
                included: parseInt(data.included, 10),
                total: data.brands.length,
                parent: data.parent
            }));

            const filteredRegions = allRegions.filter(r => r.included > filterValue);

            statsContainer.innerHTML = `<div class="stat">Total Regions: <span class="stat-value">${allRegions.length} (filtered ${filteredRegions.length})</span></div>`;

            thead.innerHTML = `
                <tr>
                    <th class="sortable" data-sort="name"># Region Name</th>
                    <th class="sortable" data-sort="included">Included Brands</th>
                    <th class="sortable" data-sort="total">Total Brands</th>
                    <th class="sortable" data-sort="parent">Parent</th>
                </tr>
            `;

            filteredRegions.sort((a, b) => {
                const valA = a[sortState.column];
                const valB = b[sortState.column];
                const compare = typeof valA === 'string' ? valA.localeCompare(valB) : valA - valB;
                return sortState.direction === 'asc' ? compare : -compare;
            });

            tbody.innerHTML = '';
            filteredRegions.forEach((region, index) => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.innerHTML = `
                    <td>${index + 1}. ${region.name}</td>
                    <td>${region.included.toLocaleString()}</td>
                    <td>${region.total.toLocaleString()}</td>
                    <td>${region.parent || 'N/A'}</td>
                `;
                row.addEventListener('click', () => displayRegionDetailView(region.name));
                tbody.appendChild(row);
            });

            thead.querySelectorAll('.sortable').forEach(header => {
                header.addEventListener('click', () => {
                    const column = header.dataset.sort;
                    sortState.column = column;
                    sortState.direction = sortState.direction === 'asc' ? 'desc' : 'asc';
                    displayGlobalStatsView();
                });
            });
        }

        function displayRegionDetailView(regionName) {
            switchView(true);
            const region = brandsRegionData[regionName];
            if (!region) return;

            document.getElementById('regionSearch').value = regionName;
            const regionTitle = document.getElementById('regionTitle');
            const table = document.getElementById('mainTable');
            const thead = table.querySelector('thead');
            const tbody = table.querySelector('tbody');
            const filterValue = parseInt(document.getElementById('countFilter').value, 10) || 0;

            regionTitle.textContent = regionName;
            regionTitle.dataset.region = regionName;

            generateBreadcrumbs(regionName);
            updateStats(regionName);
            
            thead.innerHTML = `
                <tr>
                    <th class="emoji-cell"></th>
                    <th># Brand Name</th>
                    <th>Count</th>
                    <th>Owner</th>
                    <th>Ownership Details</th>
                    <th>Reason</th>
                </tr>
            `;

            tbody.innerHTML = '';
            const filteredBrands = region.brands.filter(b => b.count > filterValue);

            if (filteredBrands.length === 0) {
                 tbody.innerHTML = `<tr><td colspan="6">No brands match the filter > ${filterValue}.</td></tr>`;
                 return;
            }

            filteredBrands.forEach((brand, index) => {
                const brandInfo = brandsData[brand.id];
                if (!brandInfo) return;

                const row = document.createElement('tr');
                if (!brandInfo.include) row.classList.add('not-included');
                
                const isOwner = brandInfo.owner === regionName;

                row.innerHTML = `
                    <td class="emoji-cell">${brandInfo.include ? '✅' : '❌'}</td>
                    <td class="${isOwner ? 'owner-brand' : ''}">${index + 1}. ${truncateText(brandInfo.name)}</td>
                    <td>${brand.count.toLocaleString()}</td>
                    <td>${brandInfo.owner}</td>
                    <td>${brandInfo.ownerCount.toLocaleString()} / ${brandInfo.globalCount.toLocaleString()} (${brandInfo.ownerPercent}%)</td>
                    <td>${truncateText(brandInfo.includeReason)}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function generateBreadcrumbs(regionName) {
            const breadcrumbsContainer = document.getElementById('breadcrumbs');
            const path = [];
            let currentRegionName = regionName;
            while (currentRegionName && currentRegionName !== 'null' && brandsRegionData[currentRegionName]) {
                path.unshift(currentRegionName);
                currentRegionName = brandsRegionData[currentRegionName].parent;
            }
            breadcrumbsContainer.innerHTML = '';
            path.forEach((name, index) => {
                if (index < path.length - 1) {
                    const link = document.createElement('a');
                    link.textContent = name;
                    link.onclick = () => displayRegionDetailView(name);
                    breadcrumbsContainer.appendChild(link);
                    breadcrumbsContainer.append(' > ');
                } else {
                    breadcrumbsContainer.append(name);
                }
            });
        }

        function updateStats(regionName) {
            const region = brandsRegionData[regionName];
            const filterValue = parseInt(document.getElementById('countFilter').value, 10) || 0;
            const statsContainer = document.getElementById('stats');
            
            const totalBrands = region.brands.length;
            const filteredBrands = region.brands.filter(b => b.count > filterValue).length;

            const totalOwned = region.brands.filter(b => brandsData[b.id]?.owner === regionName).length;
            const filteredOwned = region.brands.filter(b => brandsData[b.id]?.owner === regionName && b.count > filterValue).length;
            
            const totalIncluded = region.brands.filter(b => brandsData[b.id]?.include).length;
            const filteredIncluded = region.brands.filter(b => brandsData[b.id]?.include && b.count > filterValue).length;

            statsContainer.innerHTML = `
                <div class="stat">All: <span class="stat-value">${totalBrands} (filter ${filteredBrands})</span></div>
                <div class="stat">Included: <span class="stat-value">${totalIncluded} (filter ${filteredIncluded})</span></div>
                <div class="stat">Owned by Region: <span class="stat-value">${totalOwned} (filter ${filteredOwned})</span></div>
            `;
        }
    </script>
</body>
</html>
